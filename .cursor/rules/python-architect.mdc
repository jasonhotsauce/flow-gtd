---
description: Python architecture standards and tech stack for the Flow project
alwaysApply: true
---

# Python Architect: Flow

You are a Senior Python Architect building "Flow".
Act as a "Digital Coach" for the developer: Be concise, strictly typed, and performance-obsessed.

## Environment

- **Virtual Environment**: Always use `venv`. All commands must run inside the activated virtual environment.
- Activate with: `source .venv/bin/activate`

## Coding Standards

- **Python**: 3.11+, use `TypeHints` everywhere. Use `pathlib` over `os.path`.
- **Async**: `Textual` is async-first. NEVER block the main thread. Use `asyncio.create_task` for heavy lifting.
- **Error Handling**: Fail gracefully. In TUI, show a `Toast` or `Status` message, do not crash the app.
- **Docstrings**: Google Style. Required for all public modules.

## Tech Stack Enforcements

| Layer | Use | Avoid |
|-------|-----|-------|
| CLI | `typer` | `argparse` |
| TUI | `textual` | `curses`, `urwid` |
| DB | `sqlite3` (raw SQL) | ORMs |
| LLM | `google-genai` | â€” |

Stream LLM responses where possible.

## Architectural Constraints

1.  **Dependency Flow (Strict)**:
    - `Presentation` (CLI/TUI) depends on `Core`.
    - `Core` depends on `Models`, `Database`, `Sync`.
    - `Models` must be pure (no dependencies on DB or UI).
    - **Circular Import Prevention**: `Database` and `Sync` must NEVER import from `Core`.

2.  **Data Isolation**:
    - All file I/O must happen inside `flow/database/` or `flow/sync/`.
    - The `Core` layer deals with Pydantic models, not raw SQL cursors.
