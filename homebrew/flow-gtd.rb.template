# Homebrew formula for Flow GTD
# Generated by: make brew-formula
#
# To use this formula:
#   1. Create a tap repository: github.com/{{GITHUB_USER}}/homebrew-flow
#   2. Copy this file to: homebrew-flow/Formula/flow-gtd.rb
#   3. Users install with:
#      brew tap {{GITHUB_USER}}/flow
#      brew install flow-gtd

class FlowGtd < Formula
  include Language::Python::Virtualenv

  desc "Local-First, AI-Augmented GTD CLI for Senior Engineering Managers"
  homepage "https://github.com/{{GITHUB_USER}}/{{GITHUB_REPO}}"
  url "https://github.com/{{GITHUB_USER}}/{{GITHUB_REPO}}/archive/refs/tags/v{{VERSION}}.tar.gz"
  sha256 "{{SHA256}}"
  license "MIT"

  depends_on "python@3.11"

  def install
    # Create virtualenv with pip included
    venv = virtualenv_create(libexec, "python3.11", system_site_packages: false)
    
    # Install the package and all dependencies in one go
    venv.pip_install buildpath
    
    # Symlink the flow command to bin
    bin.install_symlink libexec/"bin/flow"
  end

  def caveats
    <<~EOS
      Flow GTD requires an LLM API key for AI features.
      
      Set up your environment:
        export FLOW_GEMINI_API_KEY="your-api-key"
      
      Or run the onboarding wizard:
        flow
      
      Data is stored locally in:
        ~/Library/Application Support/flow-gtd/
    EOS
  end

  test do
    assert_match "flow-gtd", shell_output("#{bin}/flow --version")
  end
end
